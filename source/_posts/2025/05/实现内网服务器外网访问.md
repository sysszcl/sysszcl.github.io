---
title: 实现内网服务器外网访问
abbrlink: 7342ecad
date: 2025-04-30 11:13:21
tags:
  - NetWork
categories:
  - NetWork
declare: true
reward: true
---

#### 配置环境

服务器内网环境、Windows已实现内外网同时通信

#### 一、在Windows电脑上安装代理软件

  使用第三方代理服务器软件（如CCProxy）。下载并安装CCProxy
  配置CCProxy，具体是启动CCProxy，进入“设置”或“选项”。在“代理服务”中启用HTTP、HTTPS、FTP等协议。在“账号管理”中添加允许所有机器通过。

<!-- more -->

#### 二、在Ubuntu上配置代理
 
图形界面设置
  具体是进入“设置” -> “网络” -> “网络代理”。
配置代理：选择“手动”，输入Windows机器的IP地址和CCProxy中设置的端口号（默认HTTP为8080，HTTPS为8080，FTP为21）

#### 三、命令行配置
打开终端，编辑/etc/environment文件：
```bash
sudo vim /etc/environment
```

添加以下内容：
#### 192.168.150.104为我的Windows电脑的IP
```bash
http_proxy="http://192.168.150.104:8080/"
https_proxy="http://192.168.150.104:8080/"
ftp_proxy="http://192.168.150.104:21/"
no_proxy="localhost,127.0.0.1"
```
保存并退出，然后运行：

```bash
source /etc/environment
```

#### 四、测试
   在ubuntu上打开浏览器或使用curl命令访问外部网站，确认代理上网是否生效。

```bash
curl www.baidu.com
```

#### 五、代理相关配置

##### 打开 /etc/profile文件在末尾加入：

```bash
http_proxy=http://10.103.21.19:808
https_proxy=http://10.103.21.19:808
ftp_proxy=http://10.103.21.19:808
export http_proxy https_proxy ftp_proxy no_proxy
```

保存后执行命令 source /etc/profile 使配置生效。
##### DNS配置
（要能解析公网地址的dns，配置dns后测试方法： nslookup www.baidu.com ）
打开 /etc/sysconfig/network-scripts/ifcfg-eth0 加入
 ```bash
DNS1= XXX.XXX.XXX.XXX
```
一般为114.114.114.114和8.8.8.8和8.8.4.4
##### 另外Ubuntu22.04的模式
```bash 
network:
     version: 2
     renderer: networkd
     ethernets:
       eth0:
         addresses:
           - 192.168.0.10/24
         gateway4: 192.168.0.1
         nameservers:
           addresses: [114.114.114.114,8.8.8.8, 8.8.4.4]
```
##### 保存更改

按下“Ctrl+O”保存更改，然后按下“Ctrl+X”退出nano编辑器

##### 应用配置更改：在终端中运行以下命令应用新的网络配置：
```bash
 sudo netplan apply
```
使网络配置生效

##### 验证网络连接
您可以使用以下命令检查网络接口的状态和分配的IP地址
```bash
 ip addr show
```
##### CCProx客户端测试是否能够上网,越高网速越快

查看代理
```bash
 env | grep proxy
```
验证设置是否生效 echo $http_proxy